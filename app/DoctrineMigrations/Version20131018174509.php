<?php

namespace Application\Migrations;

use Doctrine\DBAL\Migrations\AbstractMigration,
    Doctrine\DBAL\Schema\Schema;

/**
 * Auto-generated Migration: Please modify to your needs!
 */
class Version20131018174509 extends AbstractMigration
{
    public function up(Schema $schema)
    {
        // this up() migration is auto-generated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql", "Migration can only be executed safely on 'mysql'.");

        $this->addSql("CREATE TABLE remit_entry (id INT UNSIGNED NOT NULL, created_at BIGINT UNSIGNED NOT NULL, remit_account_id SMALLINT UNSIGNED NOT NULL, order_number BIGINT NOT NULL, old_order_number VARCHAR(20) NOT NULL, user_id INT NOT NULL, username VARCHAR(20) NOT NULL, user_level SMALLINT UNSIGNED NOT NULL, ancestor_id INT NOT NULL, bank_info_id INT NOT NULL, name_real VARCHAR(32) NOT NULL, method SMALLINT UNSIGNED NOT NULL, branch VARCHAR(64) DEFAULT NULL, rate NUMERIC(16, 8) NOT NULL, amount NUMERIC(16, 4) NOT NULL, amount_entry_id BIGINT NOT NULL, discount NUMERIC(16, 4) NOT NULL, discount_entry_id BIGINT NOT NULL, other_discount NUMERIC(16, 4) NOT NULL, actual_other_discount NUMERIC(16, 4) NOT NULL, other_discount_entry_id BIGINT NOT NULL, abandon_discount TINYINT(1) NOT NULL, cellphone VARCHAR(20) NOT NULL, trade_number VARCHAR(18) NOT NULL, payer_card VARCHAR(30) NOT NULL, transfer_code VARCHAR(18) NOT NULL, atm_terminal_code VARCHAR(18) NOT NULL, memo VARCHAR(255) NOT NULL, identity_card VARCHAR(18) NOT NULL, status SMALLINT UNSIGNED NOT NULL, operator VARCHAR(20) NOT NULL, deposit_at DATETIME DEFAULT NULL, confirm_at DATETIME DEFAULT NULL, duration INT UNSIGNED NOT NULL, INDEX idx_remit_entry_confirm_at (confirm_at), INDEX idx_remit_entry_created_at (created_at), INDEX idx_remit_entry_order_number (order_number), PRIMARY KEY(id, created_at)) PARTITION BY RANGE (created_at) (PARTITION p201212 VALUES LESS THAN (20130101000000), PARTITION p201301 VALUES LESS THAN (20130201000000), PARTITION p201302 VALUES LESS THAN (20130301000000), PARTITION p201303 VALUES LESS THAN (20130401000000), PARTITION p201304 VALUES LESS THAN (20130501000000), PARTITION p201305 VALUES LESS THAN (20130601000000), PARTITION p201306 VALUES LESS THAN (20130701000000), PARTITION p201307 VALUES LESS THAN (20130801000000), PARTITION p201308 VALUES LESS THAN (20130901000000), PARTITION p201309 VALUES LESS THAN (20131001000000), PARTITION p201310 VALUES LESS THAN (20131101000000), PARTITION p201311 VALUES LESS THAN (20131201000000), PARTITION p201312 VALUES LESS THAN (20140101000000), PARTITION p201401 VALUES LESS THAN (20140201000000), PARTITION p201402 VALUES LESS THAN (20140301000000), PARTITION p201403 VALUES LESS THAN (20140401000000), PARTITION p201404 VALUES LESS THAN (20140501000000), PARTITION p201405 VALUES LESS THAN (20140601000000), PARTITION p201406 VALUES LESS THAN (20140701000000), PARTITION p201407 VALUES LESS THAN (20140801000000), PARTITION p201408 VALUES LESS THAN (20140901000000), PARTITION p201409 VALUES LESS THAN (20141001000000), PARTITION p201410 VALUES LESS THAN (20141101000000), PARTITION p201411 VALUES LESS THAN (20141201000000), PARTITION p201412 VALUES LESS THAN (20150101000000), PARTITION p201501 VALUES LESS THAN (20150201000000), PARTITION p201502 VALUES LESS THAN (20150301000000), PARTITION p201503 VALUES LESS THAN (20150401000000), PARTITION p201504 VALUES LESS THAN (20150501000000), PARTITION p201505 VALUES LESS THAN (20150601000000), PARTITION p201506 VALUES LESS THAN (20150701000000), PARTITION p201507 VALUES LESS THAN (20150801000000), PARTITION p201508 VALUES LESS THAN (20150901000000), PARTITION p201509 VALUES LESS THAN (20151001000000), PARTITION p201510 VALUES LESS THAN (20151101000000), PARTITION p999999 VALUES LESS THAN MAXVALUE)");
        $this->addSql("CREATE TABLE remit_stat (id INT UNSIGNED AUTO_INCREMENT NOT NULL, user_id INT NOT NULL, month INT UNSIGNED NOT NULL, counts INT UNSIGNED NOT NULL, total NUMERIC(16, 4) NOT NULL, max_amount NUMERIC(16, 4) NOT NULL, update_at DATETIME NOT NULL, version INT DEFAULT 1 NOT NULL, INDEX idx_remit_stat_update_at (update_at), UNIQUE INDEX uni_remit_stat (user_id, month), PRIMARY KEY(id))");
        $this->addSql("CREATE TABLE remit_order (order_number BIGINT NOT NULL, created_at DATETIME NOT NULL, used TINYINT(1) NOT NULL, version INT DEFAULT 1 NOT NULL, PRIMARY KEY(order_number))");
    }

    public function down(Schema $schema)
    {
        // this down() migration is auto-generated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql", "Migration can only be executed safely on 'mysql'.");

        $this->addSql("DROP TABLE remit_order");
        $this->addSql("DROP TABLE remit_stat");
        $this->addSql("DROP TABLE remit_entry");
    }
}
